
/*!
 * jQuery Expander Plugin - v2.0.2 - 2022-01-29
 * https://kswedberg.github.io/jquery-expander/
 * Copyright (c) 2022 Karl Swedberg
 * Licensed MIT (http://kswedberg.mit-license.org/)
 */
(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory)}else if(typeof module==='object'&&typeof module.exports==='object'){module.exports=factory}else{factory(jQuery)}})(function($){$.expander={version:'2.0.2',defaults:{slicePoint:50,sliceOn:null,preserveWords:!0,normalizeWhitespace:!0,showWordCount:!1,detailPrefix:' ',wordCountText:' ({{count}} words)',widow:4,expandText:'read more',expandPrefix:'&hellip; ',expandAfterSummary:!1,wordEnd:/(&(?:[^;]+;)?|[0-9a-zA-Z\u00C0-\u0100]+|[^\u0000-\u007F]+)$/,summaryClass:'summary',detailClass:'details',moreClass:'read-more',lessClass:'read-less',moreLinkClass:'more-link',lessLinkClass:'less-link',collapseTimer:0,expandEffect:'slideDown',expandSpeed:250,collapseEffect:'slideUp',collapseSpeed:200,userCollapse:!0,userCollapseText:'read less',userCollapsePrefix:' ',onSlice:null,beforeExpand:null,afterExpand:null,onCollapse:null,afterCollapse:null}};$.fn.expander=function(options){var meth='init';if(typeof options==='string'){meth=options;options={}}
var opts=$.extend({},$.expander.defaults,options);var rSelfClose=/^<(?:area|br|col|embed|hr|img|input|link|meta|param).*>$/i;var rAmpWordEnd=opts.wordEnd;var rOpenCloseTag=/<\/?(\w+)[^>]*>/g;var rOpenTag=/<(\w+)[^>]*>/g;var rCloseTag=/<\/(\w+)>/g;var rLastCloseTag=/(<\/([^>]+)>)\s*$/;var rTagPlus=/^(<[^>]+>)+.?/;var rTrim=/(?:^\s+|\s+$)/g;var rMultiSpace=/\s\s+/g;var delayedCollapse;var removeSpaces=function(str){return opts.normalizeWhitespace?(str||'').replace(rTrim,'').replace(rMultiSpace,' '):str};var methods={init:function(){this.each(function(){var i,l,tmp,newChar,summTagless,summOpens,summCloses,lastCloseTag,detailText,detailTagless,html,expand;var $thisDetails,$readMore;var slicePointChanged;var openTagsForDetails=[];var closeTagsForsummaryText=[];var strayChars='';var defined={};var thisEl=this;var $this=$(this);var $summEl=$([]);var o=$.extend({},opts,$this.data('expander')||{});var hasDetails=!!$this.find('.'+o.detailClass).length;var hasBlocks=!!$this.find('*').filter(function(){var display=$(this).css('display');return(/^block|table|list/).test(display)}).length;var el=hasBlocks?'div':'span';var detailSelector=el+'.'+o.detailClass;var moreClass=o.moreClass+'';var lessClass=o.lessClass+'';var expandSpeed=o.expandSpeed||0;var allHtml=removeSpaces($this.html());var summaryText=allHtml.slice(0,o.slicePoint);o.moreSelector='span.'+moreClass.split(' ').join('.');o.lessSelector='span.'+lessClass.split(' ').join('.');if($.data(this,'expanderInit')){return}
$.data(this,'expanderInit',!0);$.data(this,'expander',o);$.each(['onSlice','beforeExpand','afterExpand','onCollapse','afterCollapse'],function(index,val){defined[val]=$.isFunction(o[val])});summaryText=backup(summaryText);summTagless=summaryText.replace(rOpenCloseTag,'').length;while(summTagless<o.slicePoint){newChar=allHtml.charAt(summaryText.length);if(newChar==='<'){newChar=allHtml.slice(summaryText.length).match(rTagPlus)[0]}
summaryText+=newChar;summTagless++}
if(o.sliceOn){slicePointChanged=changeSlicePoint({sliceOn:o.sliceOn,slicePoint:o.slicePoint,allHtml:allHtml,summaryText:summaryText});summaryText=slicePointChanged.summaryText}
summaryText=backup(summaryText,o.preserveWords&&allHtml.slice(summaryText.length).length);summOpens=summaryText.match(rOpenTag)||[];summCloses=summaryText.match(rCloseTag)||[];tmp=[];$.each(summOpens,function(index,val){if(!rSelfClose.test(val)){tmp.push(val)}});summOpens=tmp;l=summCloses.length;for(i=0;i<l;i++){summCloses[i]=summCloses[i].replace(rCloseTag,'$1')}
$.each(summOpens,function(index,val){var thisTagName=val.replace(rOpenTag,'$1');var closePosition=$.inArray(thisTagName,summCloses);if(closePosition===-1){openTagsForDetails.push(val);closeTagsForsummaryText.push('</'+thisTagName+'>')}else{summCloses.splice(closePosition,1)}});closeTagsForsummaryText.reverse();if(!hasDetails){detailText=allHtml.slice(summaryText.length);detailTagless=detailText.replace(rOpenCloseTag,'').replace(rTrim,'');if(detailTagless===''||detailTagless.split(/\s+/).length<o.widow){return}
lastCloseTag=closeTagsForsummaryText.pop()||'';summaryText+=closeTagsForsummaryText.join('');detailText=openTagsForDetails.join('')+detailText}else{detailText=$this.find(detailSelector).remove().html();summaryText=$this.html();allHtml=summaryText+detailText;lastCloseTag=''}
o.moreLabel=$this.find(o.moreSelector).length?'':buildMoreLabel(o,detailText);if(hasBlocks){detailText=allHtml}else if(summaryText.charAt(summaryText.length-1)==='&'){strayChars=/^[#\w\d\\]+;/.exec(detailText);if(strayChars){detailText=detailText.slice(strayChars[0].length);summaryText+=strayChars[0]}}
summaryText+=lastCloseTag;o.summary=summaryText;o.details=detailText;o.lastCloseTag=lastCloseTag;if(defined.onSlice){tmp=o.onSlice.call(thisEl,o);o=tmp&&tmp.details?tmp:o}
html=buildHTML(o,hasBlocks);$this.empty().append(html);$thisDetails=$this.find(detailSelector);$readMore=$this.find(o.moreSelector);if(o.collapseEffect==='slideUp'&&o.expandEffect!=='slideDown'||$this.is(':hidden')){$thisDetails.css({display:'none'})}else{$thisDetails[o.collapseEffect](0)}
$summEl=$this.find('div.'+o.summaryClass);expand=function(event){event.preventDefault();var exSpeed=event.startExpanded?0:expandSpeed;$readMore.hide();$summEl.hide();if(defined.beforeExpand){o.beforeExpand.call(thisEl)}
$thisDetails.stop(!1,!0)[o.expandEffect](exSpeed,function(){$thisDetails.css({zoom:''});if(defined.afterExpand){o.afterExpand.call(thisEl)}
delayCollapse(o,$thisDetails,thisEl)})};$readMore.find('a').off('click.expander').on('click.expander',expand);if(o.userCollapse&&!$this.find(o.lessSelector).length){$this.find(detailSelector).append('<span class="'+o.lessClass+'">'+o.userCollapsePrefix+'<a href="#" class="'+o.lessLinkClass+'">'+o.userCollapseText+'</a></span>')}
$this.find(o.lessSelector+' a').off('click.expander').on('click.expander',function(event){event.preventDefault();clearTimeout(delayedCollapse);var $detailsCollapsed=$(this).closest(detailSelector);reCollapse(o,$detailsCollapsed);if(defined.onCollapse){o.onCollapse.call(thisEl,!0)}});if(o.startExpanded){expand({preventDefault:function(){},startExpanded:!0})}})},destroy:function(){this.each(function(){var o,details;var $this=$(this);if(!$this.data('expanderInit')){return}
o=$.extend({},$this.data('expander')||{},opts);details=$this.find('.'+o.detailClass).contents();$this.removeData('expanderInit');$this.removeData('expander');$this.find(o.moreSelector).remove();$this.find('.'+o.summaryClass).remove();$this.find('.'+o.detailClass).after(details).remove();$this.find(o.lessSelector).remove()})}};if(methods[meth]){methods[meth].call(this)}
function buildHTML(o,blocks){var el='span';var summary=o.summary;var closingTagParts=rLastCloseTag.exec(summary);var closingTag=closingTagParts?closingTagParts[2].toLowerCase():'';if(blocks){el='div';if(closingTagParts&&closingTag!=='a'&&!o.expandAfterSummary){summary=summary.replace(rLastCloseTag,o.moreLabel+'$1')}else{summary+=o.moreLabel}
summary='<div class="'+o.summaryClass+'">'+summary+'</div>'}else{summary+=o.moreLabel}
return[summary,o.detailPrefix||'','<',el+' class="'+o.detailClass+'"','>',o.details,'</'+el+'>'].join('')}
function buildMoreLabel(o,detailText){var ret='<span class="'+o.moreClass+'">'+o.expandPrefix;if(o.showWordCount){o.wordCountText=o.wordCountText.replace(/\{\{count\}\}/,detailText.replace(rOpenCloseTag,'').replace(/&(?:amp|nbsp);/g,'').replace(/(?:^\s+|\s+$)/,'').match(/\w+/g).length)}else{o.wordCountText=''}
ret+='<a href="#" class="'+o.moreLinkClass+'">'+o.expandText+o.wordCountText+'</a></span>';return ret}
function backup(txt,preserveWords){if(txt.lastIndexOf('<')>txt.lastIndexOf('>')){txt=txt.slice(0,txt.lastIndexOf('<'))}
if(preserveWords){txt=txt.replace(rAmpWordEnd,'')}
return opts.normalizeWhitespace?txt.replace(rTrim,''):txt}
function reCollapse(o,el){el.stop(!0,!0)[o.collapseEffect](o.collapseSpeed,function(){var prevMore=el.prev('span.'+o.moreClass).show();if(!prevMore.length){el.parent().children('div.'+o.summaryClass).show().find('span.'+o.moreClass).show()}
if(o.afterCollapse){o.afterCollapse.call(el)}})}
function delayCollapse(option,$collapseEl,thisEl){if(option.collapseTimer){delayedCollapse=setTimeout(function(){reCollapse(option,$collapseEl);if($.isFunction(option.onCollapse)){option.onCollapse.call(thisEl,!1)}},option.collapseTimer)}}
function changeSlicePoint(info){var sliceOnTemp='ExpandMoreHere374216623';var summaryTextClean=info.summaryText.replace(info.sliceOn,sliceOnTemp);summaryTextClean=$('<div>'+summaryTextClean+'</div>').text();var sliceOnIndexClean=summaryTextClean.indexOf(sliceOnTemp);var sliceOnIndexHtml=info.summaryText.indexOf(info.sliceOn);if(sliceOnIndexClean!==-1&&sliceOnIndexClean<info.slicePoint){info.summaryText=info.allHtml.slice(0,sliceOnIndexHtml)}
return info}
return this};$.fn.expander.defaults=$.expander.defaults})
